<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta charset="utf-8"/>
    <title><%= title %></title>

    <meta name="description" content="Draggabble Widget Boxes with Persistent Position and State"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"/>

    <!-- bootstrap & fontawesome -->
    <link rel="stylesheet" href="/stylesheets/Ace_template_css/bootstrap.min.css"/>
    <link rel="stylesheet" href="/stylesheets/Ace_template_css/font-awesome.min.css"/>

    <!-- page specific plugin styles -->
    <link rel="stylesheet" href="/stylesheets/Ace_template_css/jquery-ui.min.css"/>
    <link rel="stylesheet" href="/bower_components/jPlayer/dist/skin/blue.monday/css/jplayer.blue.monday.min.css"/>

    <!-- text fonts -->
    <link rel="stylesheet" href="/stylesheets/Ace_template_css/fonts.googleapis.com.css"/>

    <!-- ace styles -->
    <link rel="stylesheet" href="/stylesheets/Ace_template_css/ace.min.css" class="ace-main-stylesheet"
          id="main-ace-style"/>

    <!--[if lte IE 9]>
    <link rel="stylesheet" href="/stylesheets/Ace_template_css/ace-part2.min.css" class="ace-main-stylesheet"/>
    <![endif]-->
    <link rel="stylesheet" href="/stylesheets/Ace_template_css/ace-skins.min.css"/>
    <link rel="stylesheet" href="/stylesheets/Ace_template_css/ace-rtl.min.css"/>

    <!--[if lte IE 9]>
    <link rel="stylesheet" href="/stylesheets/Ace_template_css/ace-ie.min.css"/>
    <![endif]-->

    <!-- inline styles related to this page -->
    <link rel="stylesheet" href="/stylesheets/customs/pages/application/index.css"/>

    <!-- ace settings handler -->
    <script src="/javascripts/Ace_template_js/ace-extra.min.js"></script>

    <!-- HTML5shiv and Respond.js for IE8 to support HTML5 elements and media queries -->

    <!--[if lte IE 8]>
    <script src="/javascripts/Ace_template_js/html5shiv.min.js"></script>
    <script src="/javascripts/Ace_template_js/respond.min.js"></script>
    <![endif]-->
    <style>
        .jp-gui {
            position:relative;
            padding:20px;
            width:628px;
        }
        .jp-gui.jp-no-volume {
            width:432px;
        }
        .jp-gui ul {
            margin:0;
            padding:0;
        }
        .jp-gui ul li {
            position:relative;
            float:left;
            list-style:none;
            margin:2px;
            padding:4px 0;
            cursor:pointer;
        }
        .jp-gui ul li a {
            margin:0 4px;
        }
        .jp-gui li.jp-repeat,
        .jp-gui li.jp-repeat-off {
            margin-left:344px;
        }
        .jp-gui li.jp-mute,
        .jp-gui li.jp-unmute {
            margin-left:20px;
        }
        .jp-gui li.jp-volume-max {
            margin-left:120px;
        }
        li.jp-pause,
        li.jp-repeat-off,
        li.jp-unmute,
        .jp-no-solution {
            display:none;
        }
        .jp-progress-slider {
            position:absolute;
            top:28px;
            left:100px;
            width:300px;
        }
        .jp-progress-slider .ui-slider-handle {
            cursor:pointer;
        }
        .jp-volume-slider {
            position:absolute;
            top:31px;
            left:508px;
            width:100px;
            height:.4em;
        }
        .jp-volume-slider .ui-slider-handle {
            height:.8em;
            width:.8em;
            cursor:pointer;
        }
        .jp-gui.jp-no-volume .jp-volume-slider {
            display:none;
        }
        .jp-current-time,
        .jp-duration {
            position:absolute;
            top:42px;
            font-size:0.8em;
            cursor:default;
        }
        .jp-current-time {
            left:100px;
        }
        .jp-duration {
            right:266px;
        }
        .jp-gui.jp-no-volume .jp-duration {
            right:70px;
        }
        .jp-clearboth {
            clear:both;
        }
    </style>
</head>

<body class="skin-hn">
<% include ../includes/topNav.html %>

<div class="main-container ace-save-state" id="main-container">
    <script type="text/javascript">
        try {
            ace.settings.loadState('main-container')
        } catch (e) {
        }
    </script>

    <% include ../includes/sideBar.html %>

    <div class="main-content">
        <div class="main-content-inner">

            <div class="page-content">
                <% include ../includes/ace-settings-container.html %>


                <div class="page-header">
                    <h1>
                        <%= mainDatas[0].ProjName %>
                        <small>
                            <i class="ace-icon fa fa-angle-double-right"></i>
                            <%= mainDatas[0].sites[0].SiteName %>
                        </small>
                    </h1>
                    <!-- MP3 Player -->
                    <div class="m-MP3player">
                        <div id="jquery_jplayer_1" class="jp-jplayer"></div>

                        <div id="jp_container_1">
                            <div class="jp-gui ui-widget ui-widget-content ui-corner-all">
                                <ul>
                                    <li class="jp-play ui-state-default ui-corner-all"><a href="javascript:;" class="jp-play ui-icon ui-icon-play" tabindex="1" title="play">play</a></li>
                                    <li class="jp-pause ui-state-default ui-corner-all"><a href="javascript:;" class="jp-pause ui-icon ui-icon-pause" tabindex="1" title="pause">pause</a></li>
                                    <li class="jp-stop ui-state-default ui-corner-all"><a href="javascript:;" class="jp-stop ui-icon ui-icon-stop" tabindex="1" title="stop">stop</a></li>
                                    <li class="jp-repeat ui-state-default ui-corner-all"><a href="javascript:;" class="jp-repeat ui-icon ui-icon-refresh" tabindex="1" title="repeat">repeat</a></li>
                                    <li class="jp-repeat-off ui-state-default ui-state-active ui-corner-all"><a href="javascript:;" class="jp-repeat-off ui-icon ui-icon-refresh" tabindex="1" title="repeat off">repeat off</a></li>
                                    <li class="jp-mute ui-state-default ui-corner-all"><a href="javascript:;" class="jp-mute ui-icon ui-icon-volume-off" tabindex="1" title="mute">mute</a></li>
                                    <li class="jp-unmute ui-state-default ui-state-active ui-corner-all"><a href="javascript:;" class="jp-unmute ui-icon ui-icon-volume-off" tabindex="1" title="unmute">unmute</a></li>
                                    <li class="jp-volume-max ui-state-default ui-corner-all"><a href="javascript:;" class="jp-volume-max ui-icon ui-icon-volume-on" tabindex="1" title="max volume">max volume</a></li>
                                </ul>
                                <div class="jp-progress-slider"></div>
                                <div class="jp-volume-slider"></div>
                                <div class="jp-current-time"></div>
                                <div class="jp-duration"></div>
                                <div class="jp-clearboth"></div>
                            </div>
                            <div class="jp-no-solution">
                                <span>Update Required</span>
                                To play the media you will need to either update your browser to a recent version or update your <a href="http://get.adobe.com/flashplayer/" target="_blank">Flash plugin</a>.
                            </div>
                        </div>
                    </div><!-- /MP3 Player -->

                </div><!-- /.page-header -->

                <div class="row">
                    <div class="col-xs-12">
                        <!-- PAGE CONTENT BEGINS -->
                        <div class="invisible" id="main-widget-container">

                            <% if(deviceData.length == 0) { %>
                            <div class="well well-lg">
                                该站点没有配置相应的站点设备...
                            </div>
                            <% } %>

                            <% try{deviceData.forEach(function(a, index){ %>

                            <!-- real-time: 实时数据 --> <!-- historical: 实时数据 -->

                            <div class="col-md-6 col-lg-3 widget-container-col" id="WC_<%=a.DeviceID%>">
                                <div class="widget-box widget-box-audioMonitoring" id="WB_<%=a.DeviceID%>">
                                    <div class="widget-header">
                                        <div class="widget-toolbar no-border pull-left">

                                            <!-- nav-tabs -->
                                            <ul class="nav nav-tabs" id="myTab">
                                                <li class="active">
                                                    <a data-toggle="tab" href="#NM_<%=a.DeviceID%>" aria-expanded="true"
                                                       name="实时音频监听"><i class="ace-icon fa fa-exchange"></i>
                                                        实时音频监听</a>
                                                </li>
                                                <li class="">
                                                    <a data-toggle="tab" href="#HM_<%=a.DeviceID%>"
                                                       aria-expanded="false" name="历史音频监听"><i
                                                            class="ace-icon fa fa-history"></i>
                                                        历史音频监听</a>
                                                </li>
                                            </ul><!-- /nav-tabs -->
                                        </div>

                                        <div class="widget-toolbar">
                                            <a href="#" data-action="" data-rel="tooltip" class="purple"
                                               data-original-title="历史数据">
                                                <i class="fa fa-sticky-note" aria-hidden="true"></i>
                                            </a>
                                            <a href="#" data-action="" data-rel="tooltip" class="dark"
                                               data-original-title="载入数据库">
                                                <i class="fa fa-paper-plane"></i>
                                            </a>

                                            <a href="#" data-action="fullscreen" class="pink" data-rel="tooltip"
                                               data-original-title="全屏显示">
                                                <i class="ace-icon fa fa-expand"></i>
                                            </a>

                                            <a href="#" data-action="collapse" data-rel="tooltip"
                                               data-original-title="折叠 / 收缩">
                                                <i class="ace-icon fa fa-chevron-up"></i>
                                            </a>
                                        </div>
                                    </div>


                                    <div class="widget-body">
                                        <div class="widget-main padding-6">
                                            <!-- tab-content -->
                                            <div class="tab-content">
                                                <div id="NM_<%=a.DeviceID%>" class="tab-pane active">
                                                    <div class="fixed-width-l clearfix">
                                                        <div class="fw-left" href="#" title="音频左右声道">
                                                            <img src="/images/customs/application/rule.png"
                                                                 alt="...">
                                                            <div class="strapping"></div>
                                                        </div>
                                                        <div class="fw-right">
                                                            <div class="fw-right-content">
                                                                <div class="real-time-data">
                                                                    <table class="table table-bordered no-margin-bottom Js_realTimeDataTabel"
                                                                           style="">
                                                                        <thead>
                                                                        <tr>
                                                                            <td>采集时间</td>
                                                                            <td>
                                                                                暂无数据
                                                                                <span class="site-states"
                                                                                      data-state="1"></span>
                                                                            </td>
                                                                            </td>
                                                                        </tr>
                                                                        </thead>
                                                                        <tbody>
                                                                        <tr>
                                                                            <td>设备ID</td>
                                                                            <td class="register-tag"
                                                                                title="<%= a.RegisterTagID %>"><%=
                                                                                a.RegisterTagID %>
                                                                            </td>
                                                                        </tr>
                                                                        <tr>
                                                                            <td>频率</td>
                                                                            <td class="position-relative"
                                                                                title="<%= a.RegisterDeviceID %>">
                                                                                <%= a.RegisterDeviceID %> Mhz
                                                                                <div class="tb-tail">
                                                                                    <button class="btn btn-minier btn-yellow ">
                                                                                        <i class="ace-icon fa fa-cog"></i>设置
                                                                                    </button>
                                                                                </div>
                                                                            </td>
                                                                        </tr>

                                                                        <tr>
                                                                            <td>温度</td>
                                                                            <td class="position-relative">
                                                                                <i class="ace-icon fa fa-spinner fa-spin orange bigger-125"></i>
                                                                                loading..
                                                                                <span class="tb-tail"> ℃</span></td>
                                                                        </tr>

                                                                        <tr>
                                                                            <td>湿度</td>
                                                                            <td class="position-relative">
                                                                                <i class="ace-icon fa fa-spinner fa-spin orange bigger-125"></i>
                                                                                loading..
                                                                                <span class="tb-tail">cnp</span></td>
                                                                        </tr>

                                                                        <tr>
                                                                            <td>场强</td>
                                                                            <td class="position-relative">
                                                                                <i class="ace-icon fa fa-spinner fa-spin orange bigger-125"></i>
                                                                                loading..
                                                                                <span class="tb-tail">cnp</span></td>
                                                                        </tr>

                                                                        <tr>
                                                                            <td>信噪比</td>
                                                                            <td class="position-relative">
                                                                                <i class="ace-icon fa fa-spinner fa-spin orange bigger-125"></i>
                                                                                loading..
                                                                                <span class="tb-tail">cnp</span></td>
                                                                        </tr>
                                                                        </tbody>
                                                                    </table>
                                                                </div>
                                                                <button class="btn btn-block btn-info btn-sm">
                                                                    <i class="fa fa-play" aria-hidden="true"></i>
                                                                    播放
                                                                </button>
                                                            </div>

                                                        </div>
                                                    </div>
                                                </div>

                                                <div id="HM_<%=a.DeviceID%>" class="tab-pane">
                                                    <div class="history-time-data">
                                                        <table class="table table-hover Js_Mp3List">

                                                            <thead>
                                                            <tr>
                                                                <td> 选项</td>
                                                                <td>序号</td>
                                                                <td>文件名</td>
                                                                <td>播放</td>
                                                                <td>下载</td>
                                                            </tr>
                                                            </thead>

                                                            <!-- 历史音频播放地址列表 -->
                                                            <tbody></tbody>

                                                        </table>

                                                        <ul class="pagination pagination-sm no-margin Js_pagination position-absolute"
                                                            id="PN_<%=a.DeviceID%>"></ul>

                                                    </div>
                                                </div><!-- /tab-content -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <% })}catch(err) {console.log(err)} %>

                        </div>

                        <div class="space-10"></div>

                        <div class="row">


                        </div>


                        <div class="space-10"></div>

                        <div class="row">

                        </div>

                        <div class="space-24"></div>

                        <hr/>
                        <div class="text-center">
                            <button type="reset" id="reset-widgets"
                                    class="btn btn-danger btn-white btn-bold btn-round">重置页面布局
                            </button>
                        </div>

                        <div class="space-32"></div>

                    </div><!-- PAGE CONTENT ENDS -->
                </div><!-- /.col -->
            </div><!-- /.row -->
        </div><!-- /.page-content -->
    </div>
</div><!-- /.main-content -->

<% include ../includes/footer.html %>

<a href="#" id="btn-scroll-up" class="btn-scroll-up btn btn-sm btn-inverse">
    <i class="ace-icon fa fa-angle-double-up icon-only bigger-110"></i>
</a>
</div><!-- /.main-container -->

<!-- Small modal:实时音频频率设置 -->
<div class="modal fade set-rate" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" >频率设置</h4>
            </div>
            <div class="modal-body">
                <label for="rate">频率:</label>
                <input id="rate" type="text"/>
            </div>
        </div>
    </div>
</div>

<!-- basic scripts -->

<!--[if !IE]> -->
<script src="/javascripts/Ace_template_js/jquery-2.1.4.min.js"></script>

<!-- <![endif]-->

<!--[if IE]>
<script src="/javascripts/Ace_template_js/jquery-1.11.3.min.js"></script>
<![endif]-->
<script type="text/javascript">
    if ('ontouchstart' in document.documentElement) document.write("<script src='/javascripts/Ace_template_js/jquery.mobile.custom.min.js'>" + "<" + "/script>");
</script>
<script src="/javascripts/Ace_template_js/bootstrap.min.js"></script>

<!-- page specific plugin scripts -->
<script src="/javascripts/Ace_template_js/jquery-ui.min.js"></script>
<script src="/javascripts/Ace_template_js/jquery.ui.touch-punch.min.js"></script>
<script src="/bower_components/jPlayer/dist/jplayer/jquery.jplayer.min.js"></script>
<script src="/bower_components/socket.io/socket.io-1.4.5.js"></script>

<!-- ace scripts -->
<script src="/javascripts/Ace_template_js/ace-elements.min.js"></script>
<script src="/javascripts/Ace_template_js/ace.min.js"></script>

<!-- inline scripts related to this page -->
<script type="text/javascript">
    jQuery(function ($) {
        //tooltip
        $('[data-rel=tooltip]').tooltip();
        $('[data-rel=popover]').popover({html: true});

        $('#simple-colorpicker-1').ace_colorpicker({pull_right: true}).on('change', function () {
            var color_class = $(this).find('option:selected').data('class');
            var new_class = 'widget-box';
            if (color_class != 'default')  new_class += ' widget-color-' + color_class;
            $(this).closest('.widget-box').attr('class', new_class);
        });
//        根据面板大小判断彩条是否显示
        fwLeftIfShow();
        // scrollables
        $('.scrollable').each(function () {
            var $this = $(this);
            $(this).ace_scroll({
                size: $this.attr('data-size') || 100
                //styleClass: 'scroll-left scroll-margin scroll-thin scroll-dark scroll-light no-track scroll-visible'
            });
        });
        $('.scrollable-horizontal').each(function () {
            var $this = $(this);
            $(this).ace_scroll(
                    {
                        horizontal: true,
                        styleClass: 'scroll-top',//show the scrollbars on top(default is bottom)
                        size: $this.attr('data-size') || 500,
                        mouseWheelLock: true
                    }
            ).css({'padding-top': 12});
        });

        $(window).on('resize.scroll_reset', function () {
            $('.scrollable-horizontal').ace_scroll('reset');
//            自适应实时监听面板
            fwLeftIfShow();
        });

//        根据面板大小判断彩条是否显示
        function fwLeftIfShow() {
            var box_width = $(".widget-container-col>.widget-box").width();
            if (box_width > 320) {
                $(".fw-left").css("display", "block");
                $(".fw-right-content").css("margin-left", "110px")
            } else {
                $(".fw-left").css("display", "none");
                $(".fw-right-content").css("margin-left", "0")
            }
        };

//        当插入页边距时实时监听面板设置
        $("#ace-settings-add-container").on('click', function () {
            var widgetContainer = $(".widget-container-col");
            if (widgetContainer.hasClass("col-lg-3")) {
                widgetContainer.removeClass("col-lg-3");
                widgetContainer.addClass("col-lg-6");
            } else {
                widgetContainer.removeClass("col-lg-6");
                widgetContainer.addClass("col-lg-3");
            }
        });


        $('#id-checkbox-vertical').prop('checked', false).on('click', function () {
            $('#widget-toolbox-1').toggleClass('toolbox-vertical')
                    .find('.btn-group').toggleClass('btn-group-vertical')
                    .filter(':first').toggleClass('hidden')
                    .parent().toggleClass('btn-toolbar')
        });

        /**
         //or use slimScroll plugin
         $('.slim-scrollable').each(function () {
					var $this = $(this);
					$this.slimScroll({
						height: $this.data('height') || 100,
						railVisible:true
					});
				});
         */


        /**$('.widget-box').on('setting.ace.widget' , function(e) {
					e.preventDefault();
				});*/

        /**
         $('.widget-box').on('show.ace.widget', function(e) {
					//e.preventDefault();
					//this = the widget-box
				});
         $('.widget-box').on('reload.ace.widget', function(e) {
					//this = the widget-box
				});
         */

            //$('#my-widget-box').widget_box('hide');


            // widget boxes
            // widget box drag & drop example
        $('.widget-container-col').sortable({
            connectWith: '.widget-container-col',
            items: '> .widget-box',
            handle: ace.vars['touch'] ? '.widget-title' : false,
            cancel: '.fullscreen',
            opacity: 0.8,
            revert: true,
            forceHelperSize: true,
            placeholder: 'widget-placeholder',
            forcePlaceholderSize: true,
            tolerance: 'pointer',
            start: function (event, ui) {
                //when an element is moved, it's parent becomes empty with almost zero height.
                //we set a min-height for it to be large enough so that later we can easily drop elements back onto it
                ui.item.parent().css({'min-height': ui.item.height()})
                //ui.sender.css({'min-height':ui.item.height() , 'background-color' : '#F5F5F5'})
            },
            update: function (event, ui) {
                ui.item.parent({'min-height': ''})
                //p.style.removeProperty('background-color');


                //save widget positions
                var widget_order = {}
                $('.widget-container-col').each(function () {
                    var container_id = $(this).attr('id');
                    widget_order[container_id] = []


                    $(this).find('> .widget-box').each(function () {
                        var widget_id = $(this).attr('id');
                        widget_order[container_id].push(widget_id);
                        //now we know each container contains which widgets
                    });
                });

                ace.data.set('demo', 'widget-order', widget_order, null, true);
            }
        });


        ///////////////////////

        //when a widget is shown/hidden/closed, we save its state for later retrieval
        $(document).on('shown.ace.widget hidden.ace.widget closed.ace.widget', '.widget-box', function (event) {
            var widgets = ace.data.get('demo', 'widget-state', true);
            if (widgets == null) widgets = {};

            var id = $(this).attr('id');
            widgets[id] = event.type;
            ace.data.set('demo', 'widget-state', widgets, null, true);
        });


        (function () {
            //restore widget order
            var container_list = ace.data.get('demo', 'widget-order', true);
            if (container_list) {
                for (var container_id in container_list) if (container_list.hasOwnProperty(container_id)) {

                    var widgets_inside_container = container_list[container_id];
                    if (widgets_inside_container.length == 0) continue;

                    for (var i = 0; i < widgets_inside_container.length; i++) {
                        var widget = widgets_inside_container[i];
                        $('#' + widget).appendTo('#' + container_id);
                    }

                }
            }


            //restore widget state
            var widgets = ace.data.get('demo', 'widget-state', true);
            if (widgets != null) {
                for (var id in widgets) if (widgets.hasOwnProperty(id)) {
                    var state = widgets[id];
                    var widget = $('#' + id);
                    if
                    (
                            (state == 'shown' && widget.hasClass('collapsed'))
                            ||
                            (state == 'hidden' && !widget.hasClass('collapsed'))
                    ) {
                        widget.widget_box('toggleFast');
                    }
                    else if (state == 'closed') {
                        widget.widget_box('closeFast');
                    }
                }
            }


            $('#main-widget-container').removeClass('invisible');


            //reset saved positions and states
            $('#reset-widgets').on('click', function () {
                ace.data.remove('demo', 'widget-state');
                ace.data.remove('demo', 'widget-order');
                document.location.reload();
            });

        })();

    });
</script>

<script>
    $(document).ready(function () {

        var dataStr = '<%- JSON.stringify(deviceData) %>';
        //获得后台传来的当前站点 设备信息, json 对象
        var deviceDataArry = eval('(' + dataStr + ')');

        deviceDataArry.forEach(function (item, index) {
            deviceDataArry[index] = item.DeviceID;
        });

        var socket = io.connect();
        socket.on("login", function (data) {
            socket.emit("userLogin", {name: "who", pass: "xxxx"});
            socket.emit("getData", {siteNumArry: deviceDataArry});
        });

        socket.on('data', function (data) {
            try {
                for (key in data) {
                    //获得每一个数据json对象
                    addSocketDataToPage(key, data[key]); //传入一个设备的json参数
                }
            } catch (err) {

            }
        });

        //传入一个设备的json参数
        function addSocketDataToPage(key, dataObj) {

            //如果该设备有数据

            if (dataObj) {
                //实时音频监听中的html模板
                var str1 = '<thead> <tr> <td>采集时间</td> <td> ' + dataObj.deviceData.CollTime.split(" ")[1] +
                        ' <span class="site-states" data-state="0"></span></td> </tr> </thead><tbody> <tr> <td>设备ID</td> <td class="register-tag" title="' + dataObj.deviceID + '"> '
                        + dataObj.deviceID + '</td> </tr> <tr>  <td>频率</td> <td class="position-relative" title="' + dataObj.deviceData.FMReceiveFQY + '" Mhz> ' + dataObj.deviceData.FMReceiveFQY +
                        ' Mhz<div class="tb-tail"> <button class="btn btn-minier btn-yellow" data-toggle="modal" data-target=".set-rate"><i class="ace-icon fa fa-cog"></i>设置 </button> </div> </td></tr> <tr> <td>温度</td> <td class="position-relative">'
                        + dataObj.deviceData.RoomTemp + '<span class="tb-tail"> ℃</span></td> </tr> <tr> <td>湿度</td> <td class="position-relative">' +
                        dataObj.deviceData.RoomHum + ' <span class="tb-tail">%</span></td> </tr> <tr> <td>场强</td> <td class="position-relative">' +
                        dataObj.deviceData.FMReviceRSSI + '<span class="tb-tail">N/C</span></td> </tr> <tr> <td>信噪比</td> <td class="position-relative">' +
                        dataObj.deviceData.FMReviceSNR + '<span class="tb-tail">db</span></td> </tr> </tbody></table></table>';

                try {
                    $('#WC_' + key).find(".Js_realTimeDataTabel").html(str1)
                }
                catch (err) {
                    console.log(err)
                }

                //如果该设备没有数据
            } else {
                var str2 = '<thead> <tr> <td>采集时间</td> <td>暂无数据 <span class="site-states" data-state="1"></span></td> </tr> </thead> <tbody> <tr> <td>设备ID</td> <td class="register-tag" title="暂无数据"> 暂无数据</td> </tr> <tr> <td>频率</td> <td class="position-relative" title="暂无数据"> 暂无数据<div class="tb-tail"> <button class="btn btn-minier btn-yellow" data-toggle="modal" data-target=".set-rate"><i class="ace-icon fa fa-cog"></i>设置 </button> </div> </td> </tr> <tr> <td>温度</td> <td class="position-relative">暂无数据<span class="tb-tail"> ℃</span></td> </tr> <tr> <td>湿度</td> <td class="position-relative">暂无数据<span class="tb-tail">cnp</span></td> </tr> <tr> <td>场强</td> <td class="position-relative">暂无数据<span class="tb-tail">cnp</span></td> </tr> <tr> <td>信噪比</td> <td class="position-relative">暂无数据<span class="tb-tail">cnp</span></td> </tr> </tbody></table>';
                try {
                    $('#WC_' + key).find(".Js_realTimeDataTabel").html(str2)
                }
                catch (err) {
                    console.log(err)
                }
            }
        }

    })

</script>

<script>
    $(document).ready(function () {
        $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {

            var deviceID = e.target.href.match(/#\w{2}_\w+$/)[0].replace(/#\w{2}_/, "");    //获取设备ID

            //判断选中的tab 是否是 历史音频监听标签
            if ($(this).attr("name") === "历史音频监听") {
                var pageSize = 5;

                AJAX_LOAD_Mp3List(deviceID);    //初始化加载Mp3List数据;

                function AJAX_LOAD_Mp3List(deviceID, num) {
                    $.ajax({
                        type: "POST",
                        url: '/api/monitors/getAllHistoricalAudioDataByDeviceID',
                        dataType: "JSON",
                        data: {
                            "deviceID": deviceID,
                            "currentPage": num || 1,
                            "pageSize": 5
                        },
                        success: function (result) {

                            console.log(result);

                            try {
                                var currentPage = result.currentPage;//当前页码
                                var pageTotal = result.pageTotal; //总条数
                                var Mp3ListArry = result.Mp3ListArry;//音频文件地址数组

                                setMp3ListData(deviceID, Mp3ListArry);
                                //请求数据成功 - 设置分页器
                                setPagination(deviceID, currentPage, pageSize, pageTotal);


                            } catch (err) {
                                console.log(err);
                            }
                        }
                    });
                }

                //通过设备ID ， 设置table中的播放列表;
                function setMp3ListData(deviceID, Mp3ListArry) {

                    var str = '';

                    for (var i = 0; i < Mp3ListArry.length; i++) {

                        var name = Mp3ListArry[i].match(/\d{2}_\d{2}_\w{8}.mp3$/)[0];
                        var path = Mp3ListArry[i].match(/\/\w{35}\/\d{8}\/\d{2}_\d{2}_\w{8}.mp3$/)[0];

                        str += '<tr> <td> <input type="checkbox"/> </td> <td>' + (i + 1) + '</td> <td>' + name + '</td> <td> <a href="' + path + '" class="fa fa-play-circle-o" aria-hidden="true"></a> </td> <td> <a href="' + path + '" class="fa fa-cloud-download" aria-hidden="true"></a> </td> </tr>';

                    }

                    $("#HM_" + deviceID).find(".Js_Mp3List").find("tbody").html(str);
                }

                //通过设备ID ， 分页其当前选中页码， 每一页条数， 数据总条数， 来控制历史音频数据
                function setPagination(deviceID, currentPage, pageSize, pageTotal) {
                    try {
                        var _pagination = $("#PN_" + deviceID);

                        if (_pagination) {
                            var pagetotal = pageTotal;  //总页数
                            var pagesize = pageSize;   //一页上的数据条数
                            var currentpage = currentPage;//当前页码
                            var counts, pagehtml = "";
                            if (pagetotal % pagesize == 0) {
                                counts = parseInt(pagetotal / pagesize);
                            } else {
                                counts = parseInt(pagetotal / pagesize) + 1;
                            }
                            //只有一页内容
                            if (pagetotal <= pagesize) {
                                pagehtml = "";
                            }
                            //大于一页内容
                            if (pagetotal > pagesize) {
                                if (currentpage > 1) {
                                    pagehtml += '<li><a class="" href="/index/' + (currentpage - 1) + '">上一页</a></li>';
                                }
                                for (var i = 0; i < counts; i++) {
                                    if (i >= (currentpage - 3) && i < (currentpage + 3)) {
                                        if (i == currentpage - 1) {
                                            pagehtml += '<li class="active"><a class="" href="/index/' + (i + 1) + '">' + (i + 1) + '</a></li>';
                                        } else {
                                            pagehtml += '<li><a class="" href="/index/' + (i + 1) + '">' + (i + 1) + '</a></li>';
                                        }

                                    }
                                }
                                if (currentpage < counts) {
                                    pagehtml += '<li><a class="" href="/index/' + (parseInt(currentpage) + 1) + '">下一页</a></li>';
                                }
                            }

                            _pagination.html(pagehtml);    //将计算好的分页写入页面

                            _pagination.on('click', function () {
                                return false;//阻止链接跳转
                            })
                        }
                    } catch (err) {
                        console.log(err)
                    }
                }

                setMp3LoadEvent();
            } else {
                //若当前打开的不是历史音频， 清除页面元素缓存
                $("#HM_" + deviceID).find(".Js_Mp3List").html();
            }


            function setMp3LoadEvent() {
                $(".Js_pagination").on("click", "a", function () {

                    var deviceID = $(this).closest(".Js_pagination").attr("id").replace(/^\w{2}\_/, "");

                    var selectNum = $(this).attr("href").replace(/^\/index\//, "");

                    AJAX_LOAD_Mp3List(deviceID, selectNum)
                })
            }
        });
    });
</script>

<script>
    $(document).ready(function(){

        /*
         * jQuery UI ThemeRoller
         *
         * Includes code to hide GUI volume controls on mobile devices.
         * ie., Where volume controls have no effect. See noVolume option for more info.
         *
         * Includes fix for Flash solution with MP4 files.
         * ie., The timeupdates are ignored for 1000ms after changing the play-head.
         * Alternative solution would be to use the slider option: {animate:false}
         */

        var myPlayer = $("#jquery_jplayer_1"),
                myPlayerData,
                fixFlash_mp4, // Flag: The m4a and m4v Flash player gives some old currentTime values when changed.
                fixFlash_mp4_id, // Timeout ID used with fixFlash_mp4
                ignore_timeupdate, // Flag used with fixFlash_mp4
                options = {
                    ready: function (event) {
                        // Hide the volume slider on mobile browsers. ie., They have no effect.
                        if(event.jPlayer.status.noVolume) {
                            // Add a class and then CSS rules deal with it.
                            $(".jp-gui").addClass("jp-no-volume");
                        }
                        // Determine if Flash is being used and the mp4 media type is supplied. BTW, Supplying both mp3 and mp4 is pointless.
                        fixFlash_mp4 = event.jPlayer.flash.used && /m4a|m4v/.test(event.jPlayer.options.supplied);
                        // Setup the player with media.
                        $(this).jPlayer("setMedia", {
                            // mp3: "http://www.jplayer.org/audio/mp3/Miaow-07-Bubble.mp3",
                            m4a: "http://www.jplayer.org/audio/m4a/Miaow-07-Bubble.m4a",
                            oga: "http://www.jplayer.org/audio/ogg/Miaow-07-Bubble.ogg"
                        });
                    },
                    timeupdate: function(event) {
                        if(!ignore_timeupdate) {
                            myControl.progress.slider("value", event.jPlayer.status.currentPercentAbsolute);
                        }
                    },
                    volumechange: function(event) {
                        if(event.jPlayer.options.muted) {
                            myControl.volume.slider("value", 0);
                        } else {
                            myControl.volume.slider("value", event.jPlayer.options.volume);
                        }
                    },
                    swfPath: "../../dist/jplayer",
                    supplied: "m4a, oga",
                    cssSelectorAncestor: "#jp_container_1",
                    wmode: "window",
                    keyEnabled: true
                },
                myControl = {
                    progress: $(options.cssSelectorAncestor + " .jp-progress-slider"),
                    volume: $(options.cssSelectorAncestor + " .jp-volume-slider")
                };

        // Instance jPlayer
        myPlayer.jPlayer(options);

        // A pointer to the jPlayer data object
        myPlayerData = myPlayer.data("jPlayer");

        // Define hover states of the buttons
        $('.jp-gui ul li').hover(
                function() { $(this).addClass('ui-state-hover'); },
                function() { $(this).removeClass('ui-state-hover'); }
        );

        // Create the progress slider control
        myControl.progress.slider({
            animate: "fast",
            max: 100,
            range: "min",
            step: 0.1,
            value : 0,
            slide: function(event, ui) {
                var sp = myPlayerData.status.seekPercent;
                if(sp > 0) {
                    // Apply a fix to mp4 formats when the Flash is used.
                    if(fixFlash_mp4) {
                        ignore_timeupdate = true;
                        clearTimeout(fixFlash_mp4_id);
                        fixFlash_mp4_id = setTimeout(function() {
                            ignore_timeupdate = false;
                        },1000);
                    }
                    // Move the play-head to the value and factor in the seek percent.
                    myPlayer.jPlayer("playHead", ui.value * (100 / sp));
                } else {
                    // Create a timeout to reset this slider to zero.
                    setTimeout(function() {
                        myControl.progress.slider("value", 0);
                    }, 0);
                }
            }
        });

        // Create the volume slider control
        myControl.volume.slider({
            animate: "fast",
            max: 1,
            range: "min",
            step: 0.01,
            value : $.jPlayer.prototype.options.volume,
            slide: function(event, ui) {
                myPlayer.jPlayer("option", "muted", false);
                myPlayer.jPlayer("option", "volume", ui.value);
            }
        });

    });
</script>
</body>
</html>
